<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chatroom</title>
  <style>
    /* Basic styling */
    #chatroom { max-width: 500px; margin: 20px auto; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; }
    .message { margin: 5px 0; }
    .timestamp { font-size: 0.8em; color: gray; }
  </style>
  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js"></script>
</head>
<body>

<div id="chatroom">
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button onclick="sendMessage()">Send</button>
</div>

<script>
  // Firebase Configuration and Initialization<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCxSkDp6VBikVBgi7Gpa3NcQI--nT-Btkw",
    authDomain: "thesitechat1.firebaseapp.com",
    databaseURL: "https://thesitechat1-default-rtdb.firebaseio.com",
    projectId: "thesitechat1",
    storageBucket: "thesitechat1.firebasestorage.app",
    messagingSenderId: "241521613265",
    appId: "1:241521613265:web:0fc2422f358789c1b528f0",
    measurementId: "G-6FYM94FK7X"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>

  // Firebase Database Reference
  const db = firebase.database();

  // Retrieve Username from Session Storage
  let userName = sessionStorage.getItem("userName") || "Anonymous";

  function sendMessage() {
    const message = document.getElementById("messageInput").value;
    if (message.trim()) {
      const timestamp = new Date().toLocaleTimeString();
      db.ref("messages").push({
        user: userName,
        text: message,
        time: timestamp
      });
      document.getElementById("messageInput").value = '';
    }
  }

  db.ref("messages").on("child_added", snapshot => {
    const msg = snapshot.val();
    const msgDiv = document.createElement("div");
    msgDiv.classList.add("message");
    msgDiv.innerHTML = `<strong>${msg.user}</strong>: ${msg.text} <span class="timestamp">(${msg.time})</span>`;
    document.getElementById("messages").appendChild(msgDiv);
  
